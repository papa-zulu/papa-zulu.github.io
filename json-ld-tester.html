<!doctype html>
<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonld/1.6.2/jsonld.js"></script>
</head>
<body>
Enter compact JSON-LD data:
<br / >
<textarea id="input-textarea" cols="100" rows="20"></textarea>
<br / >
<br / >
Expanded:
<br / >
<pre id="output"></pre>
<br / >
<div id="error"></div>

<script>
	document.getElementById('input-textarea').addEventListener("input", parseInput);

	function parseInput() {
		try {
			console.log(JSON.parse(this.value.trim()));
			jsonld.expand(JSON.parse(this.value.trim()), function(err, expanded) {
				
				var formatted = JSON.stringify(expanded, null, 2);
				document.getElementById('output').innerHTML = formatted;
				console.log(formatted);

				if (err !== null) {
					document.getElementById('error').innerHTML = err.message;
				} else {
					document.getElementById('error').innerHTML = '';
				}
			});
		} catch(e) {
			document.getElementById('error').innerHTML = e.message;
		}
	}


	const doc = {
	  "http://schema.org/name": "Manu Sporny",
	  "http://schema.org/url": {"@id": "http://manu.sporny.org/"},
	  "http://schema.org/image": {"@id": "http://manu.sporny.org/images/manu.png"}
	};
	const context = {
	  "name": "http://schema.org/name",
	  "homepage": {"@id": "http://schema.org/url", "@type": "@id"},
	  "image": {"@id": "http://schema.org/image", "@type": "@id"}
	};

	// compact a document according to a particular context
	jsonld.compact(doc, context, function(err, compacted) {
		console.log('Compacted');
	  	console.log(JSON.stringify(compacted, null, 2));
	  	console.log('-----------------------');
	  /* Output:
	  {
	    "@context": {...},
	    "name": "Manu Sporny",
	    "homepage": "http://manu.sporny.org/",
	    "image": "http://manu.sporny.org/images/manu.png"
	  }
	  */

	  expand(compacted);
	});


	function expand(compactedData) {
	// expand a document, removing its context
		jsonld.expand(compactedData, function(err, expanded) {

			console.log('Expanded');
			console.log(JSON.stringify(expanded, null, 2));
			console.log('-----------------------');
		  /* Output:
		  {
		    "http://schema.org/name": [{"@value": "Manu Sporny"}],
		    "http://schema.org/url": [{"@id": "http://manu.sporny.org/"}],
		    "http://schema.org/image": [{"@id": "http://manu.sporny.org/images/manu.png"}]
		  }
		  */
		});
	}

	// flatten a document
	jsonld.flatten(doc, (err, flattened) => {
	  // all deep-level trees flattened to the top-level
	  console.log('Flattened');
	  console.log(JSON.stringify(flattened, null, 2));
	  console.log('-----------------------');
	});

/*
	// frame a document
	jsonld.frame(doc, document.getElementById('frame'), (err, framed) => {
	  // document transformed into a particular tree structure per the given frame
	  console.log('Framed');
	  console.log(JSON.stringify(framed, null, 2));
	  console.log('-----------------------');
	});
	*/
</script>

</body>
</html>
